<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Login</title>
  <link rel="stylesheet" href="./Styles/log-in.css">
  <link rel="stylesheet" href="./Styles/header.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">

  <!-- Firebase via CDN -->
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged, 
  signOut, 
  signInWithEmailAndPassword, 
  GoogleAuthProvider, 
  signInWithPopup, 
  sendPasswordResetEmail 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

import { getFirestore, doc, getDoc, setDoc  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCYDGROxguHYX-YA-J-HqRRGSF3uN-ZEAs",
  authDomain: "fenix-construtora-a34b5.firebaseapp.com",
  projectId: "fenix-construtora-a34b5",
  storageBucket: "fenix-construtora-a34b5.firebasestorage.app",
  messagingSenderId: "928009241790",
  appId: "1:928009241790:web:333b16b217a2ece01d8aef"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

// Elementos do header/modal
const logBtn = document.getElementById("log");
const registerBtn = document.getElementById("register");
const iconPerson = document.querySelector(".icon-person");
const userArea = document.getElementById("userArea");
const closeUserArea = document.getElementById("closeUserArea");
const welcomeMsg = document.getElementById("welcomeMsg");
const userEmail = document.getElementById("userEmail");
const btnLogoutModal = document.getElementById("btnLogoutModal");

// Atualiza header conforme login
onAuthStateChanged(auth, async (user) => {
  if (user) {
    btnLogoutModal.style.display = "flex";
    logBtn.style.display = "none";
    registerBtn.style.display = "none";

    // Pega dados do Firestore
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);
    const nome = docSnap.exists() ? docSnap.data().nome : user.displayName || "UsuÃ¡rio";

    welcomeMsg.textContent = `Bem-vindo(a), ${nome}`;
    userEmail.textContent = user.email;
  } else {
    btnLogoutModal.style.display = "none";
    logBtn.style.display = "flex";
    registerBtn.style.display = "flex";
  }
});

// Abre/fecha modal do usuÃ¡rio
iconPerson.addEventListener("click", () => userArea.style.display = "flex");
closeUserArea.addEventListener("click", () => userArea.style.display = "none");
window.addEventListener("click", (e) => {
  if (e.target === userArea) userArea.style.display = "none";
});

// POPUP
window.showPopup = function(message) {
  const popup = document.getElementById("popup");
  document.getElementById("popup-message").innerText = message;
  popup.style.display = "flex";
}
window.closePopup = function() {
  document.getElementById("popup").style.display = "none";
}
window.onclick = function(event) {
  const popup = document.getElementById("popup");
  if (event.target === popup) popup.style.display = "none";
}

// Login com email/senha
window.loginUser = async (event) => {
  event.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  try {
    await signInWithEmailAndPassword(auth, email, password);
    showPopup("âœ… Login realizado com sucesso!");
    setTimeout(() => window.location.href = "./index.html", 2000);
  } catch (error) {
    showPopup("âŒ Erro ao entrar: " + error.message);
  }
};

// Login Google
window.loginGoogle = async () => {
  try {
    const result = await signInWithPopup(auth, provider);

    // Caso seja primeiro login, garante documento no Firestore
    const docRef = doc(db, "users", result.user.uid);
    const docSnap = await getDoc(docRef);
    if (!docSnap.exists()) {
      await setDoc(docRef, {
        nome: result.user.displayName || "",
        email: result.user.email || "",
        admin: false
      });
    }

    showPopup(`âœ… Bem-vindo, ${result.user.displayName}!`);
    setTimeout(() => window.location.href = "./index.html", 2000);
  } catch (error) {
    showPopup("âŒ Erro ao entrar com Google: " + error.message);
  }
};

// RedefiniÃ§Ã£o de senha
window.resetPassword = () => {
  const email = document.getElementById("email").value;
  if (!email) {
    showPopup("âš ï¸ Digite seu e-mail para recuperar a senha.");
    return;
  }
  sendPasswordResetEmail(auth, email)
    .then(() => showPopup("ðŸ“§ E-mail de redefiniÃ§Ã£o enviado!"))
    .catch((error) => showPopup("âŒ Erro: " + error.message));
};

// Logout
btnLogoutModal.addEventListener("click", () => {
  signOut(auth).then(() => {
    showPopup("VocÃª saiu da conta.");
    setTimeout(() => window.location.reload(), 1500);
  }).catch((err) => showPopup("Erro ao sair: " + err.message));
});

  </script>
</head>
<body>
    <header>
  <div class="navbar">
    <div class="logo">
        <a href="./index.html">
      <img src="./img/fenix51.png" alt="" />
    </a>
    <div class="title-fenix">
      <h3>FÃŠNIX <span>CONSTRUTORA</span></h3>
      
    </div>
    </div>

    <div class="abas">
      <a href="./index.html"><p>Inicio</p></a>
      <a href="./sobre.html"><p>Sobre NÃ³s</p></a>
      <a href="Imovel.html"><p>ImÃ³veis</p></a>
      <a href="./serviÃ§os.html"><p>ServiÃ§os</p></a>
      <a href="./contato.html"><p>Contato</p></a>
    </div>

    <div class="barra"><hr></div>



    <!-- Menu do usuÃ¡rio logado (vai substituir o login/sign-in) -->

    <div class="displau-subs" >
        <div class="icon-person">
            <img src="./img/icon-usuario.png" alt="">
        </div>
    </div>

    <div id="userArea" class="modal" style="display:none;">
  <div class="modal-content">
    <span id="closeUserArea" class="close">&times;</span>
    <h2 id="welcomeMsg">Bem-vindo(a), UsuÃ¡rio</h2>
    <p id="userEmail">Email do usuÃ¡rio</p>

    <div class="logadores">

    <a id="logi" href="./log-in.html">
    <button id="log">
      <p>Login</p>
    </button>
    </a>


    <a id="registeri" href="./sign-in.html">
    <button id="register">
      <p>Sign-in</p>
    </button>
</a>
    
    </div>
        <button id="btnLogoutModal">
        <img src="./img/sair.png" alt="">
    </button>

  </div>
</div>
    
  </div>
</header>

<main>
  <div class="titulos1">
    <h3><b>FALE AGORA</b> COM UM CONSULTOR FÃŠNIX</h3>
    <h1>LOG-IN</h1>
    <img src="./img/icon-usuario.png" alt="icon-usuario">
  </div>

  <form onsubmit="loginUser(event)">
    <label for="email">Digite o seu Email</label>
    <input type="email" placeholder="Email" id="email" required>

    <label for="password">Digite sua senha</label>
    <input type="password" placeholder="Senha" id="password" required>

    <p class="esqueceuasenha">
      Esqueceu a senha? <span><a href="#" onclick="resetPassword()">Clique aqui</a></span>
    </p>

    <div class="barras">
      <div class="barrinha"></div>
      <p>ou, entre com</p>
      <div class="barrinha"></div>
    </div>

    <div class="opcoes-login">
        <img src="./img/logo-google.png" alt="logo-google" onclick="loginGoogle()" style="cursor:pointer;">  
        <img src="./img/logo-facebook.png" alt="logo.facebook">  
        <img src="./img/logo-apple.png" alt="logo.apple">  
    </div>

    <button type="submit" class="btn-entrar">Entrar</button>
    <p>Ã‰ um cliente FÃªnix e nÃ£o possui uma conta?</p>
    <a class="registrar" href="sign-in.html">Registre-se</a>
  </form>
</main>

<footer>
  <div class="rodape">
    <div class="foot-logo">
      <img src="./img/image 39.svg" alt="Logo" class="logo" />
      <div class="titulos">
        <div class="titulo"><p>FÃŠNIX</p></div>
        <div class="subtitle"><p>CONSTRUTORA</p></div>
      </div>
    </div>
    <div class="contatos">
      <div class="cont1">
        <div class="cont-title1"><h3>REDES SOCIAIS</h3></div>
        <div class="conte">
          <div class="icon"><img src="./img/insta.png" alt=""></div>
          <div class="rede"><p>INSTAGRAM</p></div>      
        </div>
      </div>
      <div class="cont2">
        <div class="titulo2"><h3>NOSSA EMPRESA</h3></div>
        <div class="abins">
          <p>SOBRE NÃ“S</p>
          <p>CONTATO</p>
          <p>SERVIÃ‡OS</p>
        </div>
      </div>
      <div class="cont3">
        <div class="titulo3"><h3>NOSSOS PRODUTOS</h3></div>
        <div class="produts">
          <p>PROJETOS</p>
          <p>IMÃ“VEIS</p>
        </div>
      </div>
    </div>
    <div class="direitos-reservados" style="color: white;">
      <p>&copy; 2025 FÃªnix Construtora. Todos os direitos reservados.</p>
    </div>
  </div>
</footer>

<!-- POPUP -->
<div id="popup" class="popup">
  <div class="popup-content">
    <span class="close-btn" onclick="closePopup()">&times;</span>
    <p id="popup-message"></p>
  </div>
</div>

</body>
</html>
